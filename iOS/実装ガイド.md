# 双極AI iOSアプリ 実装ガイド

## 実装状況

### ✅ フェーズA（完了）

- [x] データモデル（DailyLog, CalculationResult）
- [x] GAS API通信サービス
- [x] 入力画面（Mood + 定型質問4本）
- [x] 結果表示画面
- [x] アプリ統合

### ✅ フェーズB（コード準備完了）

- [x] HealthKitデータモデル
- [x] HealthKitService（基本構造）
- ⚠️ 実際のHealthKit読み取り実装は、Xcodeでビルドしてから実装が必要

### ✅ フェーズC（コード準備完了）

- [x] LINE Notify APIサービス
- [x] 設定画面（トークン入力）

### ✅ フェーズD（コード準備完了）

- [x] Rebootプログラム画面
- [x] Rebootアクションボタン

## Mac環境での実装手順

### ステップ1: Xcodeプロジェクトを作成

1. Xcodeを起動
2. 「Create a new Xcode project」を選択
3. 「iOS」→「App」を選択
4. プロジェクト名：`BipolarAI`
5. Interface：`SwiftUI`を選択
6. Language：`Swift`を選択
7. 保存場所を選択

### ステップ2: コードをコピー

`C:\Users\yasut\BipolarAI\iOS\` フォルダ内のすべてのSwiftファイルを、Xcodeプロジェクトの対応するフォルダにコピー：

```
iOS/
├── Models/
│   ├── DailyLog.swift
│   ├── CalculationResult.swift
│   └── HealthKitData.swift
├── Services/
│   ├── GASService.swift
│   ├── HealthKitService.swift
│   └── LineNotifyService.swift
├── Views/
│   ├── InputView.swift
│   ├── ResultView.swift
│   ├── SettingsView.swift
│   ├── RebootView.swift
│   └── Components/
│       └── StageButton.swift
├── Utils/
│   └── Constants.swift
├── BipolarAIApp.swift
└── ContentView.swift
```

### ステップ3: Info.plistにHealthKit権限を追加

1. プロジェクトナビゲーターで `Info.plist` を選択
2. 以下のキーを追加：

```xml
<key>NSHealthShareUsageDescription</key>
<string>健康データを読み取って、双極性障害の状態を分析します</string>
<key>NSHealthUpdateUsageDescription</key>
<string>健康データを更新します</string>
```

または、Xcodeの「Signing & Capabilities」タブで「HealthKit」を追加

### ステップ4: GASエンドポイントURLを更新

`Utils/Constants.swift` の `GAS_ENDPOINT_URL` を最新のデプロイURLに更新：

```swift
static let GAS_ENDPOINT_URL = "https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec"
```

### ステップ5: HealthKitServiceの実装を完成

`Services/HealthKitService.swift` の各メソッド（`fetchStepCount`, `fetchActiveEnergy` など）の実装を完成させる必要があります。

現在はプレースホルダーなので、実際のHealthKit読み取りコードを実装してください。

### ステップ6: ビルドとテスト

1. シミュレーターまたは実機を選択
2. 「Run」ボタンをクリック（⌘R）
3. アプリが起動したら、入力画面でデータを入力して送信
4. 結果画面が表示されることを確認

## 実装の優先順位

### 1. フェーズAの動作確認（最優先）

まず、フェーズAが正常に動作することを確認してください。

### 2. フェーズB：HealthKit連携

HealthKitServiceの実装を完成させ、データ取得を実装します。

### 3. フェーズC：LINE通知

LINE Notify APIのトークンを設定して、通知機能を実装します。

### 4. フェーズD：Reboot通知

RebootプログラムのUIと通知機能を実装します。

## 注意事項

### HealthKit

- HealthKitは実機でのみ動作します（シミュレーターでは動作しません）
- アクセス許可が必要です
- 一部のデータ（摂取kcal、飲酒など）は、HealthKitで取得できない可能性があります

### LINE Notify

- トークンは設定画面で入力します
- トークンは安全に保存してください（Keychain推奨）

### GASエンドポイントURL

- デプロイするたびにURLが変わる可能性があります
- 最新のURLを `Constants.swift` に設定してください

## トラブルシューティング

### ビルドエラー

- ファイルが正しくコピーされているか確認
- フォルダ構造が正しいか確認
- Xcodeでファイルを追加する際は、「Copy items if needed」にチェック

### ネットワークエラー

- GASエンドポイントURLが正しいか確認
- インターネット接続を確認
- GASエンドポイントが正常に動作しているか確認（ブラウザで `?mode=health` を確認）

### HealthKitエラー

- Info.plistに権限説明を追加
- 実機でテスト（シミュレーターでは動作しません）
- 設定アプリでHealthKitのアクセス許可を確認

